var _0x2902=['Error\x20Detectado:\x20','detectedErrorState','Error\x20Detectado\x20Extendido:\x20','extendedDetectedErrorState','¿Es\x20printer\x20Zebra?','esPrinterZebra','.......','Listo','addWarning','latido_equipo_ok','ver_hwCliente','ver_hwClienteData','detalle_hwCliente','detalle_hwClienteShow','promise','probe','done','alive','ping_ip','sys','toString','bind','Respuesta\x20=\x20','################################################','IP:\x20','registrar_log','**************************************************************','INSERT\x20INTO\x20tblalertas_log\x20(idequipo,descripcion)\x0a\x09\x09\x09\x09\x09\x20\x20VALUES\x20((SELECT\x20idequipo\x20FROM\x20tblequipo\x20WHERE\x20ipID=?),?)','Printer=','\x20-\x20generalState=','generalState','printerStatus','\x20\x0a\x09\x09\x09\x09\x09-\x20extendedPrinterStatus=','\x20-\x20detectedError=','\x20\x0a\x09\x09\x09\x09\x09-\x20extendedDetectedError=','extendedDetectedError','refresh_lista_equipos','Se\x20ejecutó\x20iniciarEstadosKioskos','disconnect','addOffline','splice','Se\x20perdió\x20conexión\x20con\x20cliente\x20de\x20monitoreo','----','---','INSERT\x20INTO\x20tblalertas_log\x20(idequipo,descripcion)\x0a\x09\x09\x09\x09\x20\x20VALUES\x20((SELECT\x20idequipo\x20FROM\x20tblequipo\x20WHERE\x20ipID=?),?)','Se\x20ha\x20registrado\x20un\x20nuevo\x20evento\x20desconexion\x20el\x20log,\x20equipo:\x20','listen','express','body-parser','express-handlebars','path','connect-flash','express-session','simple-crypto-js','default','./lib/secret','./contadores','set','views','engine','main','join','get','layouts','partials','.hbs','./lib/handlebars','view\x20engine','use','dev','urlencoded','json','locals','success','flash','/kiosko','./routes/kiosko','/usuario','./routes/usuario','./routes/logs','Server','ping','socket.io','./public/js/setServerDb.js','Router','env','PORT','mysql','createPool','host','user','pass','SELECT\x20*\x20FROM\x20tblequipo\x20WHERE\x20estado=1\x20LIMIT\x20500','session','header','Cache-Control','private,\x20no-cache,\x20no-store,\x20must-revalidate','sendFile','/public/index.html','/index.html','route','/login','/public/login.html','body','buscar','username','loginUsuario','email','userMail','idperfil','idusuario','idUsuario','redirect','/login_error.html','/logout','/username','static','/public','getConnection','length','Select\x20idusuario,\x20email,\x20password,\x20idPerfil,estado\x20from\x20tblusuario\x20WHERE\x20(estado\x20<>\x200\x20AND\x20estado\x20<>\x202)','query','log','Listado\x20de\x20usuarios\x20cargados\x20en\x20memoria,\x20total\x20','release','SELECT\x20idusuario,\x20email,\x20password,\x20idPerfil,\x20estado\x20FROM\x20tblusuario\x20WHERE\x20(estado\x20<>\x200\x20AND\x20estado\x20<>\x202)','decrypt','password','Algo\x20pasó\x20al\x20intentar\x20cargar\x20los\x20usuarios,\x20check\x20index.js','trim','idPerfil','schedule','0\x2018\x20*\x20*\x20sunday','DELETE\x20FROM\x20tblalertas_log\x20WHERE\x20fecha\x20<\x20DATE_SUB(NOW(),\x20INTERVAL\x203\x20MONTH)','Tarea\x20programada\x20ejecutada...\x20Se\x20ha\x20eliminado\x20el\x20log\x20de\x20alertas\x20posterior\x20a\x203\x20meses!','setInitialState','setTotal','fillOffline','fillDatosTblEquipo','connection','handshake','ipClienteX','undefined','indexOf','push','addReady','sockets','emit','mostrar_lstEquipos','datosTblEquipo','ready','warning','offline','ver_status','IP\x20Cliente:\x20','IpId:\x20','ipID','Printer\x20Name:\x20','printerName','Estado\x20del\x20Impresor:\x20','extendedPrinterStatus'];(function(_0x37229a,_0xacc825){var _0xba5c5b=function(_0x30ecdd){while(--_0x30ecdd){_0x37229a['push'](_0x37229a['shift']());}};_0xba5c5b(++_0xacc825);}(_0x2902,0x171));var _0x29d1=function(_0x45658b,_0xa6ed42){_0x45658b=_0x45658b-0x0;var _0x51c273=_0x2902[_0x45658b];return _0x51c273;};const express=require(_0x29d1('0x0'));const morgan=require('morgan');const bodyP=require(_0x29d1('0x1'));const exphbs=require(_0x29d1('0x2'));const path=require(_0x29d1('0x3'));const flash=require(_0x29d1('0x4'));const session=require(_0x29d1('0x5'));const SimpleCrypto=require(_0x29d1('0x6'))[_0x29d1('0x7')];const _secretKey=require(_0x29d1('0x8'));let simpleCrypto=new SimpleCrypto(_secretKey);let cron=require('node-cron');let estado=require(_0x29d1('0x9'));const app=express();app[_0x29d1('0xa')](_0x29d1('0xb'),path['join'](__dirname,_0x29d1('0xb')));app[_0x29d1('0xc')]('.hbs',exphbs({'defaultLayout':_0x29d1('0xd'),'layoutsDir':path[_0x29d1('0xe')](app[_0x29d1('0xf')]('views'),_0x29d1('0x10')),'partialsDir':path[_0x29d1('0xe')](app[_0x29d1('0xf')](_0x29d1('0xb')),_0x29d1('0x11')),'extname':_0x29d1('0x12'),'helpers':require(_0x29d1('0x13'))}));app['set'](_0x29d1('0x14'),'.hbs');app[_0x29d1('0x15')](morgan(_0x29d1('0x16')));app[_0x29d1('0x15')](session({'secret':'gbmsv','resave':![],'saveUninitialized':!![]}));app[_0x29d1('0x15')](flash());app[_0x29d1('0x15')](bodyP[_0x29d1('0x17')]({'extended':![]}));app[_0x29d1('0x15')](bodyP[_0x29d1('0x18')]());app[_0x29d1('0x15')]((_0x54676f,_0x3720d1,_0x3b3135)=>{app[_0x29d1('0x19')][_0x29d1('0x1a')]=_0x54676f[_0x29d1('0x1b')](_0x29d1('0x1a'));_0x3b3135();});app[_0x29d1('0x15')](require('./routes'));app[_0x29d1('0x15')](_0x29d1('0x1c'),require(_0x29d1('0x1d')));app[_0x29d1('0x15')](_0x29d1('0x1e'),require(_0x29d1('0x1f')));app['use']('/logs',require(_0x29d1('0x20')));var http=require('http')[_0x29d1('0x21')](app);var ping=require(_0x29d1('0x22'));var io=require(_0x29d1('0x23'))(http);var database=require(_0x29d1('0x24'))['dbServer'];var router=express[_0x29d1('0x25')]();var bodyParser=require(_0x29d1('0x1'));app[_0x29d1('0x15')](bodyParser[_0x29d1('0x18')]());app['use'](bodyParser[_0x29d1('0x17')]({'extended':![]}));var port=process[_0x29d1('0x26')][_0x29d1('0x27')]||0xbb8;var mysql=require(_0x29d1('0x28'));var pool=mysql[_0x29d1('0x29')]({'host':database[_0x29d1('0x2a')],'user':database[_0x29d1('0x2b')],'password':database[_0x29d1('0x2c')],'insecureAuth':!![],'database':database['db'],'port':database['port']});var socketCount=0x0;var equiposConectados=[];var equiposAlertados=[];var ipIdCliente=-0x1;var quitarIpId=-0x1,quitarIpIdPos=-0x1;var listEquipos=_0x29d1('0x2d');var usersInfo=[];var usuariosConectados=[];var sess;router[_0x29d1('0xf')]('/',requireLogin,function(_0x4e0447,_0x502db7){sess=_0x4e0447[_0x29d1('0x2e')];_0x502db7[_0x29d1('0x2f')](_0x29d1('0x30'),_0x29d1('0x31'));_0x502db7[_0x29d1('0x32')](__dirname+_0x29d1('0x33'));});router[_0x29d1('0xf')](_0x29d1('0x34'),requireLogin,function(_0x413623,_0x58be54){sess=_0x413623[_0x29d1('0x2e')];_0x58be54[_0x29d1('0x2f')](_0x29d1('0x30'),_0x29d1('0x31'));_0x58be54['sendFile'](__dirname+_0x29d1('0x33'));});router[_0x29d1('0x35')](_0x29d1('0x36'))[_0x29d1('0xf')](function(_0x1d5b04,_0x5320c8){_0x5320c8['header'](_0x29d1('0x30'),_0x29d1('0x31'));_0x5320c8[_0x29d1('0x32')](__dirname+_0x29d1('0x37'));})['post'](async function(_0x52b97f,_0x458612){await refrescarUsuarios();sess=_0x52b97f[_0x29d1('0x2e')];var _0x329689=_0x52b97f[_0x29d1('0x38')];var _0x568200=sesionUsuario[_0x29d1('0x39')](usersInfo,_0x329689['loginUsuario'],_0x329689['loginPassword']);if(_0x568200!==-0x1){sess[_0x29d1('0x3a')]=_0x329689[_0x29d1('0x3b')];sess[_0x29d1('0x3c')]=_0x568200[_0x29d1('0x3d')];sess[_0x29d1('0x3e')]=_0x568200['userPerfil'];sess[_0x29d1('0x3f')]=_0x568200[_0x29d1('0x40')];_0x458612[_0x29d1('0x41')](_0x29d1('0x34'));}else{_0x458612[_0x29d1('0x41')](_0x29d1('0x42'));}});router[_0x29d1('0xf')](_0x29d1('0x43'),function(_0x1ddc41,_0x2be65e){_0x1ddc41[_0x29d1('0x2e')]['destroy']();_0x2be65e['redirect'](_0x29d1('0x36'));});router[_0x29d1('0xf')](_0x29d1('0x44'),function(_0x146639,_0x23f1f4){sess=_0x146639[_0x29d1('0x2e')];_0x23f1f4[_0x29d1('0x18')]({'myUserName':sess[_0x29d1('0x3a')],'myUserId':sess[_0x29d1('0x3c')],'myPerfil':sess['idperfil'],'myIdUsuario':sess['idusuario']});});app[_0x29d1('0x15')]('/',router);app[_0x29d1('0x15')](express[_0x29d1('0x45')](__dirname+_0x29d1('0x46')));function requireLogin(_0x267447,_0x71ab26,_0x2f324a){sess=_0x267447[_0x29d1('0x2e')];if(!sess[_0x29d1('0x3a')]){_0x71ab26[_0x29d1('0x41')]('/login');}else{_0x2f324a();}};pool[_0x29d1('0x47')](function(_0x18623a,_0x4f1cde){usersInfo[_0x29d1('0x48')]=0x0;var _0x5a68d3=_0x29d1('0x49');_0x4f1cde[_0x29d1('0x4a')](_0x5a68d3,async function(_0x18623a,_0x27a9a1){if(_0x18623a){console['log'](_0x18623a);return;}else{usersInfo=await decryptPass(_0x27a9a1);console[_0x29d1('0x4b')](_0x29d1('0x4c')+usersInfo['length']);}_0x4f1cde[_0x29d1('0x4d')]();});});function refrescarUsuarios(){pool[_0x29d1('0x47')](function(_0x392401,_0x172f73){var _0x204117=_0x29d1('0x4e');_0x172f73[_0x29d1('0x4a')](_0x204117,async function(_0x392401,_0x1a2713){if(_0x392401){console[_0x29d1('0x4b')](_0x392401);return;}else{usersInfo=await decryptPass(_0x1a2713);console['log']('Listado\x20de\x20usuarios\x20cargados\x20en\x20memoria,\x20total\x20'+usersInfo[_0x29d1('0x48')]);}_0x172f73[_0x29d1('0x4d')]();});});}function decryptPass(_0x193c11){if(_0x193c11[0x0]){for(let _0x2eae15=0x0;_0x2eae15<_0x193c11[_0x29d1('0x48')];_0x2eae15++){let _0x29a889=simpleCrypto[_0x29d1('0x4f')](_0x193c11[_0x2eae15][_0x29d1('0x50')]);_0x193c11[_0x2eae15][_0x29d1('0x50')]=_0x29a889;}return _0x193c11;}return{'error':_0x29d1('0x51')};}async function encryptOnDataBase(_0x43b7f6){if(_0x43b7f6[0x0]){for(let _0x440fd8=0x0;_0x440fd8<_0x43b7f6['length'];_0x440fd8++){let _0x3c61f7=simpleCrypto['encrypt'](_0x43b7f6[_0x440fd8][_0x29d1('0x50')]);await pool[_0x29d1('0x4a')]('UPDATE\x20tblusuario\x20SET\x20password=?\x20WHERE\x20idusuario\x20=\x20?',[_0x3c61f7,_0x43b7f6[_0x440fd8][_0x29d1('0x3f')]]);}}console[_0x29d1('0x4b')]('*****ERROR\x20en\x20funcion\x20encryptOnDataBase,\x20index.js');}var sesionUsuario={'buscar':function(_0x2dc6a0,_0x1a7766,_0x3cd6db){for(var _0x51082b=0x0;_0x51082b<_0x2dc6a0[_0x29d1('0x48')];_0x51082b++){if(_0x2dc6a0[_0x51082b]['email']===_0x1a7766['trim']()&&_0x2dc6a0[_0x51082b][_0x29d1('0x50')]===_0x3cd6db[_0x29d1('0x52')]()){return{'userMail':_0x2dc6a0[_0x51082b][_0x29d1('0x3c')],'userPerfil':_0x2dc6a0[_0x51082b][_0x29d1('0x53')],'idUsuario':_0x2dc6a0[_0x51082b][_0x29d1('0x3f')]};}}return-0x1;}};cron[_0x29d1('0x54')](_0x29d1('0x55'),()=>{pool[_0x29d1('0x4a')](_0x29d1('0x56'));console[_0x29d1('0x4b')](_0x29d1('0x57'));});function iniciarEstadosKioskos(){estado[_0x29d1('0x58')]();pool[_0x29d1('0x4a')](listEquipos,function(_0x1d378d,_0x33c9a3,_0x2715a3){if(_0x1d378d)throw _0x1d378d;estado[_0x29d1('0x59')](_0x33c9a3[_0x29d1('0x48')]);estado[_0x29d1('0x5a')](_0x33c9a3);estado[_0x29d1('0x5b')](_0x33c9a3);});}iniciarEstadosKioskos();io['on'](_0x29d1('0x5c'),function(_0x182d2d){ipIdCliente=_0x182d2d[_0x29d1('0x5d')][_0x29d1('0x4a')][_0x29d1('0x5e')];socketCount++;console[_0x29d1('0x4b')]('++++');if(typeof ipIdCliente!==_0x29d1('0x5f')&&ipIdCliente!==null){console[_0x29d1('0x4b')]('Cliente\x20Conectado...'+ipIdCliente);if(equiposConectados[_0x29d1('0x60')](ipIdCliente)==-0x1){equiposConectados[_0x29d1('0x61')](ipIdCliente);estado[_0x29d1('0x62')](ipIdCliente);}console[_0x29d1('0x4b')]('Total\x20clientes\x20conectados:\x20'+equiposConectados[_0x29d1('0x48')]);}else{console[_0x29d1('0x4b')]('Cliente\x20conectado\x20a\x20Interfaz\x20de\x20monitoreo,\x20socket.id='+_0x182d2d['id']);io[_0x29d1('0x63')][_0x29d1('0x64')](_0x29d1('0x65'),estado[_0x29d1('0x66')],estado[_0x29d1('0x67')],estado[_0x29d1('0x68')],estado[_0x29d1('0x69')],equiposConectados[_0x29d1('0x48')]);console[_0x29d1('0x4b')]('Listado\x20de\x20equipos\x20enviados\x20a\x20GUI\x20de\x20monitoreo!');}_0x182d2d['on'](_0x29d1('0x6a'),function(_0x2ffc56){console['log'](_0x29d1('0x6b')+_0x2ffc56['ip']);console[_0x29d1('0x4b')](_0x29d1('0x6c')+_0x2ffc56[_0x29d1('0x6d')]);console[_0x29d1('0x4b')](_0x29d1('0x6e')+_0x2ffc56[_0x29d1('0x6f')]);console['log'](_0x29d1('0x70')+_0x2ffc56['generalState']);console[_0x29d1('0x4b')]('Estado\x20(string):\x20'+_0x2ffc56['printerStatus']);console[_0x29d1('0x4b')]('Estado\x20extendido\x20\x20del\x20Impresor:\x20'+_0x2ffc56[_0x29d1('0x71')]);console[_0x29d1('0x4b')](_0x29d1('0x72')+_0x2ffc56[_0x29d1('0x73')]);console['log'](_0x29d1('0x74')+_0x2ffc56[_0x29d1('0x75')]);console[_0x29d1('0x4b')](_0x29d1('0x76'),_0x2ffc56[_0x29d1('0x77')]);console[_0x29d1('0x4b')](_0x29d1('0x78'));if(equiposConectados[_0x29d1('0x60')](_0x2ffc56[_0x29d1('0x6d')])===-0x1){equiposConectados[_0x29d1('0x61')](_0x2ffc56[_0x29d1('0x6d')]);}if(_0x2ffc56['generalState']===_0x29d1('0x79')){estado[_0x29d1('0x62')](_0x2ffc56['ipID']);}else{estado[_0x29d1('0x7a')](_0x2ffc56['ipID']);}io[_0x29d1('0x63')]['emit'](_0x29d1('0x7b'),_0x2ffc56,equiposConectados[_0x29d1('0x48')],estado['ready'],estado['warning'],estado[_0x29d1('0x69')]);});_0x182d2d['on'](_0x29d1('0x7c'),function(_0x36f813){io[_0x29d1('0x63')][_0x29d1('0x64')](_0x29d1('0x7d'),_0x36f813);});_0x182d2d['on'](_0x29d1('0x7e'),function(_0x2f7be0,_0x4388d2,_0x43b75c,_0x449749){io[_0x29d1('0x63')][_0x29d1('0x64')](_0x29d1('0x7f'),{'os':_0x2f7be0,'cpu':_0x4388d2,'detMem':_0x43b75c,'detDisk':_0x449749});});var _0x411bb1=![];function _0x46204a(_0x53addb){var _0x51438c=![];ping[_0x29d1('0x80')][_0x29d1('0x81')](_0x53addb)['then'](function(_0x2854cd){_0x543226(_0x2854cd);})[_0x29d1('0x82')]();return _0x411bb1;};function _0x543226(_0x4c6b37){_0x411bb1=_0x4c6b37[_0x29d1('0x83')];};_0x182d2d['on'](_0x29d1('0x84'),function(_0x5e53e1){var _0x31a8f2=0x0;for(var _0x3b45cc=0x0;_0x3b45cc<=_0x5e53e1[_0x29d1('0x48')]-0x1;_0x3b45cc++){ping[_0x29d1('0x85')]['probe'](_0x5e53e1[_0x3b45cc]['ip'][_0x29d1('0x86')](),function(_0x274ed0){if(_0x274ed0){_0x31a8f2=0x1;}else{_0x31a8f2=0x0;}_0x5e53e1[this['p']]['Respuesta']=_0x31a8f2;io[_0x29d1('0x63')]['emit']('ping_ipResp',_0x5e53e1[this['p']]);}[_0x29d1('0x87')]({'p':_0x3b45cc}));console[_0x29d1('0x4b')](_0x29d1('0x88')+_0x31a8f2);console[_0x29d1('0x4b')](_0x29d1('0x89'));console[_0x29d1('0x4b')](_0x29d1('0x8a')+_0x5e53e1[_0x3b45cc]['ip']+'\x20'+_0x5e53e1[_0x3b45cc]['Respuesta']);}});_0x182d2d['on'](_0x29d1('0x8b'),function(_0x7b0044){console[_0x29d1('0x4b')](_0x29d1('0x8c'));pool[_0x29d1('0x47')](function(_0xc6468b,_0x341caf){var _0x5666f7=_0x29d1('0x8d');var _0x253ba1=_0x29d1('0x8e')+_0x7b0044['printerName']+_0x29d1('0x8f')+_0x7b0044[_0x29d1('0x90')]+'\x20-\x20printerStatus='+_0x7b0044[_0x29d1('0x91')]+_0x29d1('0x92')+_0x7b0044[_0x29d1('0x71')]+_0x29d1('0x93')+_0x7b0044[_0x29d1('0x73')]+_0x29d1('0x94')+_0x7b0044[_0x29d1('0x95')];_0x341caf['query'](_0x5666f7,[_0x7b0044['ipID'],_0x253ba1],async function(_0xc6468b,_0x448f39){if(_0xc6468b){console['log'](_0xc6468b);return;}else{console['log']('Se\x20ha\x20registrado\x20un\x20nuevo\x20evento\x20en\x20el\x20log,\x20equipo:\x20'+_0x7b0044['ip']);}_0x341caf[_0x29d1('0x4d')]();});});});_0x182d2d['on'](_0x29d1('0x96'),async function(){await iniciarEstadosKioskos();console[_0x29d1('0x4b')](_0x29d1('0x97'));});_0x182d2d['on'](_0x29d1('0x98'),function(){socketCount--;quitarIpId=_0x182d2d['handshake'][_0x29d1('0x4a')][_0x29d1('0x5e')];if(typeof quitarIpId!==_0x29d1('0x5f')&&quitarIpId!==null){estado[_0x29d1('0x99')](quitarIpId);quitarIpIdPos=equiposConectados['indexOf'](quitarIpId);equiposConectados[_0x29d1('0x9a')](quitarIpIdPos,0x1);io[_0x29d1('0x63')][_0x29d1('0x64')]('conexion_cliente',equiposConectados['length']);_0x3161f0(quitarIpId,_0x29d1('0x9b'));}io['sockets'][_0x29d1('0x64')]('equipo_desconectado',quitarIpId,equiposConectados[_0x29d1('0x48')],estado['ready'],estado[_0x29d1('0x68')],estado['offline']);console['log'](_0x29d1('0x9c'));console['log']('Cliente\x20desconectado...'+quitarIpId);console[_0x29d1('0x4b')]('Total\x20clientes\x20conectados:\x20'+equiposConectados[_0x29d1('0x48')]);console[_0x29d1('0x4b')](_0x29d1('0x9d'));});function _0x3161f0(_0x4a387c,_0x362a48){if(_0x4a387c>0x0&&_0x362a48!==''&&_0x362a48!==undefined&&_0x362a48!==null){pool[_0x29d1('0x47')](function(_0x58b4a6,_0x567147){var _0x468003=_0x29d1('0x9e');_0x567147[_0x29d1('0x4a')](_0x468003,[_0x4a387c,_0x362a48],async function(_0x58b4a6,_0xb8cc8e){if(_0x58b4a6){console[_0x29d1('0x4b')](_0x58b4a6);return;}else{console[_0x29d1('0x4b')](_0x29d1('0x9f')+_0x4a387c);}_0x567147[_0x29d1('0x4d')]();});});}}});http[_0x29d1('0xa0')](port,function(){console['log']('listening\x20on\x20*:'+port);});